{{- $cdn := site.Params.assetsCDN | default "" -}}
{{- $src := .Get "src" -}}
{{- $caption := .Get "caption" | default "" -}}
{{- $width := .Get "width" | default "100%" -}}
{{- $autoplay := .Get "autoplay" | default "false" -}}
{{- $loop := .Get "loop" | default "false" -}}
{{- $muted := .Get "muted" | default "false" -}}
{{- $poster := .Get "poster" | default "" -}}
{{- $videoSrc := $src -}}
{{- $posterSrc := $poster -}}
{{- if and $cdn (not (hasPrefix $src "http")) -}}
  {{- $videoSrc = printf "%s%s" $cdn $src -}}
{{- end -}}
{{- if and $cdn $poster (not (hasPrefix $poster "http")) -}}
  {{- $posterSrc = printf "%s%s" $cdn $poster -}}
{{- end -}}
{{- /* Auto-generate poster path: .mp4 -> -poster.jpg */ -}}
{{- if not $poster -}}
  {{- $posterPath := replace $src ".mp4" "-poster.jpg" -}}
  {{- if $cdn -}}
    {{- $posterSrc = printf "%s%s" $cdn $posterPath -}}
  {{- else -}}
    {{- $posterSrc = $posterPath -}}
  {{- end -}}
{{- end -}}

<figure>
  <video data-src="{{ $videoSrc }}" controls playsinline
    preload="none"
    poster="{{ $posterSrc }}"
    {{ if eq $autoplay "true" }}autoplay{{ end }}
    {{ if eq $loop "true" }}loop{{ end }}
    {{ if eq $muted "true" }}muted{{ end }}
    style="width: {{ $width }}; border-radius: 8px;">
  </video>
  {{- if $caption }}
  <figcaption style="text-align: center; color: #888; font-size: 0.9em; margin-top: 0.5em;">{{ $caption }}</figcaption>
  {{- end }}
</figure>
