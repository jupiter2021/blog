{{ define "main" }}
<div class="travel-container">
    <div class="travel-header">
        <h1>Travel Log | æ—…è¡Œè¶³è¿¹</h1>
        
        <blockquote class="travel-quote">
            "The wish to travel seems to me characteristically human," the famed explorer and writer Paul Theroux once said. "That desire to move, to satisfy your curiosity or ease your fears, to change the circumstances of your life, to be a stranger, to make a friend, to experience an exotic landscape, to risk the unknown."
        </blockquote>
        
        <div class="travel-info">
            ğŸŒ This page shows my travel footprints. / è¿™æ˜¯æˆ‘çš„æ—…è¡Œè¶³è¿¹ã€‚
        </div>
    </div>
    
    <div id="globeViz"></div>
    
    <div class="travel-stats">
        <div class="stat-item">
            <div class="stat-number" id="countryCount">0</div>
            <div class="stat-label">å›½å®¶/åœ°åŒº</div>
        </div>
        <div class="stat-item">
            <div class="stat-number" id="cityCount">0</div>
            <div class="stat-label">åŸå¸‚</div>
        </div>
    </div>

    <!-- æ¸¸è®°åŒºåŸŸ -->
    <div class="travel-journals">
        <h2 class="journals-title">ğŸ“– æ¸¸è®°</h2>
        <p class="journals-subtitle">è®°å½•æ—…é€”ä¸­çš„æ‰€è§æ‰€é—»ä¸æ„Ÿæ‚Ÿ</p>

        <!-- å¾’æ­¥ -->
        <div class="journal-section">
            <h3 class="section-title"><span class="section-icon">ğŸ¥¾</span> å¾’æ­¥</h3>
            <div class="journal-grid">
                {{ range where .Site.RegularPages "Params.tags" "intersect" (slice "å¾’æ­¥") }}
                <a href="{{ .Permalink }}" class="journal-card">
                    <div class="journal-card-image">
                        {{ if .Params.image }}
                        <img src="{{ .Params.image }}" alt="{{ .Title }}" loading="lazy">
                        {{ else }}
                        <div class="journal-card-placeholder">ğŸ¥¾</div>
                        {{ end }}
                    </div>
                    <div class="journal-card-content">
                        <h4 class="journal-card-title">{{ .Title }}</h4>
                        <div class="journal-card-meta">
                            <span class="journal-card-date">{{ .Date.Format "2006-01-02" }}</span>
                            {{ if .Params.tags }}
                            <div class="journal-card-tags">
                                {{ range first 3 .Params.tags }}
                                <span class="journal-tag">{{ . }}</span>
                                {{ end }}
                            </div>
                            {{ end }}
                        </div>
                        <p class="journal-card-summary">{{ .Summary | plainify | truncate 80 }}</p>
                    </div>
                </a>
                {{ end }}
            </div>
        </div>

        <!-- è§‚å…‰ -->
        <div class="journal-section">
            <h3 class="section-title"><span class="section-icon">ğŸ›ï¸</span> è§‚å…‰</h3>
            <div class="journal-grid">
                {{ range where .Site.RegularPages "Params.tags" "intersect" (slice "è§‚å…‰") }}
                <a href="{{ .Permalink }}" class="journal-card">
                    <div class="journal-card-image">
                        {{ if .Params.image }}
                        <img src="{{ .Params.image }}" alt="{{ .Title }}" loading="lazy">
                        {{ else }}
                        <div class="journal-card-placeholder">ğŸ›ï¸</div>
                        {{ end }}
                    </div>
                    <div class="journal-card-content">
                        <h4 class="journal-card-title">{{ .Title }}</h4>
                        <div class="journal-card-meta">
                            <span class="journal-card-date">{{ .Date.Format "2006-01-02" }}</span>
                            {{ if .Params.tags }}
                            <div class="journal-card-tags">
                                {{ range first 3 .Params.tags }}
                                <span class="journal-tag">{{ . }}</span>
                                {{ end }}
                            </div>
                            {{ end }}
                        </div>
                        <p class="journal-card-summary">{{ .Summary | plainify | truncate 80 }}</p>
                    </div>
                </a>
                {{ end }}
            </div>
        </div>
    </div>
</div>

<style>
.travel-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 20px;
}

.travel-header h1 {
    font-size: 2rem;
    font-weight: 300;
    margin-bottom: 20px;
    font-family: 'Courier New', monospace;
}

.travel-quote {
    background: #fff8f0;
    border-left: 4px solid #f5a623;
    padding: 20px;
    margin-bottom: 20px;
    font-style: italic;
    color: #666;
    line-height: 1.8;
}

.travel-info {
    background: #fff8f0;
    padding: 15px 20px;
    margin-bottom: 30px;
    color: #333;
    font-size: 1rem;
}

#globeViz {
    width: 100%;
    height: 550px;
    display: flex;
    justify-content: center;
    align-items: center;
}

.travel-stats {
    display: flex;
    justify-content: center;
    gap: 40px;
    margin-top: 30px;
    padding: 20px;
    background: var(--card-background, #f9f9f9);
    border-radius: 10px;
}

.stat-item {
    text-align: center;
}

.stat-number {
    font-size: 2rem;
    font-weight: bold;
    color: #f5a623;
}

.stat-label {
    color: var(--body-text-color, #666);
    font-size: 0.9rem;
}

.dark .travel-quote, .dark .travel-info {
    background: rgba(245, 166, 35, 0.1);
    color: rgba(255, 255, 255, 0.85);
}

/* æ¸¸è®°åŒºåŸŸ */
.travel-journals {
    margin-top: 50px;
}

.journals-title {
    font-size: 1.8rem;
    font-weight: 600;
    margin-bottom: 6px;
}

.journals-subtitle {
    color: var(--body-text-color, #888);
    font-size: 0.95rem;
    margin-bottom: 30px;
}

.journal-section {
    margin-bottom: 40px;
}

.section-title {
    font-size: 1.3rem;
    font-weight: 600;
    margin-bottom: 16px;
    padding-bottom: 8px;
    border-bottom: 2px solid #f5a623;
    display: inline-block;
}

.section-icon {
    margin-right: 6px;
}

.journal-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
}

.journal-card {
    display: flex;
    flex-direction: column;
    border-radius: 12px;
    overflow: hidden;
    background: var(--card-background, #fff);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    text-decoration: none !important;
    color: inherit;
}

.journal-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
}

.journal-card-image {
    width: 100%;
    height: 180px;
    overflow: hidden;
}

.journal-card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.journal-card:hover .journal-card-image img {
    transform: scale(1.05);
}

.journal-card-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3rem;
    background: linear-gradient(135deg, #fff8f0, #ffe8cc);
}

.journal-card-content {
    padding: 16px;
}

.journal-card-title {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 8px;
    line-height: 1.4;
}

.journal-card-meta {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
}

.journal-card-date {
    font-size: 0.8rem;
    color: var(--body-text-color, #999);
}

.journal-card-tags {
    display: flex;
    gap: 4px;
}

.journal-tag {
    font-size: 0.72rem;
    padding: 2px 8px;
    border-radius: 12px;
    background: rgba(245, 166, 35, 0.15);
    color: #e6951c;
}

.journal-card-summary {
    font-size: 0.88rem;
    color: var(--body-text-color, #666);
    line-height: 1.6;
    margin: 0;
}

@media (max-width: 640px) {
    .journal-grid {
        grid-template-columns: 1fr;
    }
}
</style>

<script src="https://unpkg.com/globe.gl@2.27.0/dist/globe.gl.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // ä» Hugo data æ–‡ä»¶åŠ è½½æ—…è¡Œæ•°æ®
    const travelData = {{ .Site.Data.travel | jsonify | safeJS }};

    const uniqueCountries = [...new Set(travelData.map(d => d.country))];
    document.getElementById('countryCount').textContent = uniqueCountries.length;
    document.getElementById('cityCount').textContent = travelData.length;

    const container = document.getElementById('globeViz');
    
    const globe = Globe()(container)
        .globeImageUrl('https://unpkg.com/three-globe@2.45.0/example/img/earth-blue-marble.jpg')
        .backgroundColor('rgba(0,0,0,0)')
        .showAtmosphere(true)
        .atmosphereColor('#b8d4e8')
        .atmosphereAltitude(0.2)
        .pointsData(travelData)
        .pointLat('lat')
        .pointLng('lng')
        .pointColor(() => '#f5a623')
        .pointAltitude(0)
        .pointRadius(0.35)
        .pointLabel(d => `
            <div style="background: rgba(0,0,0,0.75); color: white; padding: 8px 12px; border-radius: 6px; font-size: 14px;">
                <b>${d.name}</b><br/>
                <span style="color: #f5a623;">${d.country}</span>
            </div>
        `);

    globe.pointOfView({ lat: 25, lng: 115, altitude: 1.38 });
    globe.controls().autoRotate = true;
    globe.controls().autoRotateSpeed = 0.5;

    // æ ¹æ®ç¼©æ”¾çº§åˆ«åŠ¨æ€è°ƒæ•´ç‚¹çš„å¤§å°ï¼ˆå¸¦æœ€å°å€¼é™åˆ¶ï¼‰
    const baseRadius = 0.35;
    const minRadius = 0.15;  // æœ€å°ç‚¹å¤§å°
    const baseAltitude = 1.38;
    
    function updatePointSize() {
        const currentAltitude = globe.pointOfView().altitude;
        const scale = currentAltitude / baseAltitude;
        const newRadius = Math.max(minRadius, baseRadius * scale);
        globe.pointRadius(newRadius);
    }
    
    // ç›‘å¬ç¼©æ”¾å˜åŒ–
    globe.controls().addEventListener('change', updatePointSize);

    // é¼ æ ‡æ‚¬åœ/æ‹–åŠ¨æ—¶åœæ­¢æ—‹è½¬ï¼Œç¦»å¼€åæ¢å¤
    container.addEventListener('mouseenter', () => {
        globe.controls().autoRotate = false;
    });
    container.addEventListener('mouseleave', () => {
        globe.controls().autoRotate = true;
    });

    function handleResize() {
        globe.width(container.offsetWidth);
        globe.height(container.offsetHeight);
    }
    window.addEventListener('resize', handleResize);
    handleResize();
});
</script>
{{ end }}
